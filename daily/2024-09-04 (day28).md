JNDI
https://tomcat.apache.org/tomcat-9.0-doc/jndi-resources-howto.html

톰캣에서 데이터를 저장하는 방법은 여러가지
- Generic JavaBean Resources
- Memory UserDatabase 
- DataSource UserDatabase 
- JavaMail Sessions
- JDBC Data Sources


우리는 JDBC Data Sources 이부분을 따라한다

webapp/META-INF/context.xml
``` xml
<?xml version="1.0" encoding="UTF-8"?>
<Context>
  <Resource name="jdbc/MemoDB"
            auth="Container"
            type="javax.sql.DataSource"
            username="dbusername"
            password="dbpassword"
            driverClassName="org.h2.Driver"
            url="jdbc:HypersonicSQL:database"
            maxTotal="8"
            maxIdle="4"/>
</Context>
```

webapp/WEB-INF/web.xml
``` xml
<resource-ref>
  <res-ref-name>jdbc/MemoDB</res-ref-name>
  <res-type>javax.sql.DataSource</res-type>
  <res-auth>Container</res-auth>
</resource-ref>
```

context resource name 과 web.xml 의 res-ref-name을 동일하게 만들어 준다.


xml의 Context를 이용하기 때문에 Tomcat 웹서비스 환경을 지원하는 환경이 아니라면 사용불가겠지?


``` java
package org.comstudy.myweb.dbcp;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.sql.DataSource;


public class JdbcUtil {
//... 중략
	public static Connection getConnection() {
		try {
			if (conn == null) {	 // 한명한테만 서빙하면..
				InitialContext initCtx =  new InitialContext();
				Context envCtx = (Context)initCtx.lookup("java:comp/env");
				DataSource ds = (DataSource) envCtx.lookup("jdbc/MemoDB");
	
				conn = ds.getConnection();
			}
		} catch (NamingException | SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
		
		return conn;
	}
}
```


### Mybatis
RDB 보다 객체를 그대로 사용 할 수 있게 도와주는 Mapper

JDBC<---- 이 사이 어딘가(Mybatis) ---->JPA  ( jpql )

Mybatis는 xml 에다 sql을 직접넣어 사용..


eclipse 단축키
CTRL + SHIFT + O : 전체 import
ctrl + shift + f : 자동정렬


#### mybatis 사용하기
기본적으로 mybatis 설정 xml 파일을 거쳐 설정한다


org/mybatis/example/mybatis-config.xml
``` xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
  <properties resource="application.properties">
  	<property name="driver" value="org.h2.Driver"/>
  </properties>
  <environments default="development">
    <environment id="development">
      <transactionManager type="JDBC"/>
      <dataSource type="POOLED">
        <property name="driver" value="${driver}"/>
        <property name="url" value="${url}"/>
        <property name="username" value="${username}"/>
        <property name="password" value="${password}"/>
      </dataSource>
    </environment>
  </environments>
  <mappers>
    <!-- 이쪽에 매핑을 시켜줍니다.. -->
  </mappers>
</configuration>

```

datasource를 xml에 그대로 넣기 싫어서 application.properties 파일을 src/main/java 에 넣음
``` properties
# h2 database connection
url=jdbc:h2:tcp://localhost/~/test
username=sa
password=
```


결국 파일, 폴더 구조는 요렇게 됐다
![[Pasted image 20240904141757.png]]

##### xml 방식으로 사용하기
``` xml
<mappers>
<!-- xml 매핑 -->
<mapper resource="org/mybatis/example/BlogMapper.xml"/>
</mappers>
```

##### interface 방식으로 사용하기
``` xml
<mappers>
<!-- 인터페이스 매핑 -->
	<mapper class="org.mybatis.example.BlogMapper" /> 
</mappers>
```


두개의 큰 차이는 xml mapper 에서 class 를 쓰냐



![[Pasted image 20240904140932.png]]



SqlSessionFactory 같은 BoilerPlate는 DAO 생성자에 넣는다?




### 다음수업예고 : Spring Boot 기본, Thymeleaf, JSP

spring - 중하급 개발자가 사용하면 중중고급 개발자가 될 수 있음 (레거시 집약체)
백엔드 spring/ 프론트-react

Monolithic  vs MSA


sts 

eclipse sts - 


##### 질문사항
``` java
public class Blog {
	public Blog()

}
``` 
생성자 오버로딩을 이용하는 것( this(파라미터들) )과 직접 넣는것 어떤지..


강사님 질문 미리 드립니다.
src/main/java/application.properties 파일을 사용했는데 이 파일은 어떻게 잡히는 건가요?
이클립스에서 잡아 주는 건가요?






육회비빔밥 / 콩국수 / 나베 / 그라탕 / 스테이크 / 슈바인학센 / 세이로무시 / 오마카세



